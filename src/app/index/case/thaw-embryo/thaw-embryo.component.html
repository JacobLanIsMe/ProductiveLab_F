<app-base-treatment-info></app-base-treatment-info>
<div class="d-flex justify-content-between align-items-center">
<app-title [title]="'解凍胚胎'" [icon]="faListCheck"></app-title>
<app-subfunction-header [subfunctions]="subfunctions"></app-subfunction-header>
</div>
<hr>
<div style="width:100%;overflow:auto">
    <div class="text-center" *ngIf="embryoFreezesResult">{{embryoFreezesResult}}</div>
    <app-loading-spinner *ngIf="isLoading"></app-loading-spinner>
    <table class="table" *ngIf="embryoFreezes.length">
        <thead>
            <tr>
                <th>
                    <div class="d-flex justify-content-center align-items-center">
                        <div class="me-1">全選</div>
                        <input type="checkbox" (click)="onSelectAllOvum($event)" [(ngModel)]="isAllOvumChecked">
                    </div>
                </th>
                <th>療程編號</th>
                <th>胚胎編號</th>
                <th>冷凍日期</th>
                <th>冷凍天數</th>
                <th>受精結果</th>
                <th>囊胚期胚胎評分</th>
                <th>分裂期胚胎評分</th>
                <th>胚胎狀況</th>
                <th>KID Score</th>
                <th>PGTA編號</th>
                <th>PGTA結果</th>
                <th>PGTM結果</th>
                <th>照片</th>
                <th>冷凍液</th>
                <th>Tank</th>
                <th>Canist</th>
                <th>Strip</th>
                <th>Top編號</th>
                <th>Top顏色</th>
                <th>備註</th>
            </tr>
        </thead>
        <tbody>
            <tr *ngFor="let item of embryoFreezes">
                <th>
                    <input type="checkbox"
                        (change)="onSelectOneOvum($event, item.freezeStorageInfo.unitInfo.storageUnitId)"
                        [(ngModel)]="item.isChecked">
                </th>
                <td>{{item.courseOfTreatmentSqlId}}</td>
                <td>{{item.ovumNumber}}</td>
                <td>{{item.freezeTime | date:"yyyy-MM-dd"}}</td>
                <td>{{item.freezeObservationNoteInfo.day}}</td>
                <td>{{item.freezeObservationNoteInfo.fertilisationResultName}}</td>
                <td>
                    <ng-container
                        *ngIf="item.freezeObservationNoteInfo.blastocystScore_Expansion_Name || item.freezeObservationNoteInfo.blastocystScore_ICE_Name || item.freezeObservationNoteInfo.blastocystScore_TE_Name">
                        {{item.freezeObservationNoteInfo.blastocystScore_Expansion_Name}}{{item.freezeObservationNoteInfo.blastocystScore_ICE_Name}}{{item.freezeObservationNoteInfo.blastocystScore_TE_Name}}
                    </ng-container>
                </td>
                <td>
                    <ng-container
                        *ngIf="item.freezeObservationNoteInfo.blastomereScore_C_Name || item.freezeObservationNoteInfo.blastomereScore_G_Name || item.freezeObservationNoteInfo.blastomereScore_F_Name">
                        {{item.freezeObservationNoteInfo.blastomereScore_C_Name}}G{{item.freezeObservationNoteInfo.blastomereScore_G_Name}}F{{item.freezeObservationNoteInfo.blastomereScore_F_Name}}
                    </ng-container>
                </td>
                <td>{{item.freezeObservationNoteInfo.embryoStatusName}}</td>
                <td>{{item.freezeObservationNoteInfo.kidScore}}</td>
                <td>{{item.freezeObservationNoteInfo.pgtaNumber}}</td>
                <td>{{item.freezeObservationNoteInfo.pgtaResult}}</td>
                <td>{{item.freezeObservationNoteInfo.pgtmResult}}</td>
                <td>
                    <div class="m-auto d-flex justify-content-center align-items-center"
                        style="width:50px;aspect-ratio:1/1;"
                        *ngIf="item.freezeObservationNoteInfo.observationNotePhotos.length>0">
                        <img [src]="'data:image/gif;base64,' + item.freezeObservationNoteInfo.observationNotePhotos[0].imageBase64String"
                            style="max-width:100%;max-height:100%;">
                    </div>
                </td>
                <td>{{item.medium}}</td>
                <td>{{item.freezeStorageInfo.tankInfo.tankName}}</td>
                <td>{{item.freezeStorageInfo.canistName}}</td>
                <td>{{item.freezeStorageInfo.stripBoxId}}</td>
                <td>{{item.freezeStorageInfo.unitInfo.unitName}}</td>
                <td>{{item.freezeStorageInfo.topColorName}}</td>
                <td>{{item.freezeObservationNoteInfo.memo}}</td>
            </tr>
        </tbody>
    </table>
</div>
<app-thaw-ovum-embryo-form *ngIf="isOpenSubfunction && isOpenSubfunction.functionId === 32" [function]="isOpenSubfunction"></app-thaw-ovum-embryo-form>